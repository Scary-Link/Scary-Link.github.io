<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ScaryLink</title>
<style>
    body {
        margin: 0;
        font-family: monospace;
        background: black;
        color: lime;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        text-align: center;
    }

    .container {
        max-width: 650px;
        padding: 20px;
    }

    input, button {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        font-family: monospace;
        font-size: 16px;
    }

    button {
        cursor: pointer;
        background: lime;
        color: black;
        border: none;
        font-weight: bold;
    }

    .loading {
        font-size: 22px;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0%,50%,100% {opacity:1;}
        25%,75% {opacity:0;}
    }

    .output {
        margin-top: 15px;
        word-break: break-all;
    }
</style>
</head>
<body>
<div class="container" id="app"></div>

<script>
/* ---------------- Weighted Chaos Arrays ---------------- */

const prefixParts = [
  '',
  '',
  '',
  'phish_',
  'account_',
  'hidden_',
  'install_',
  'exploit_',
  'root_',
  'dox_',
  'arpa_',
  'logger_',
  'impersonate_',
  'lottery_',
  'ad_',
  'campaign_',
  'flash_',
  'urgent_',
  'TODO_obfuscate_url_'
];
const baseNames = [
  'ping_flood',
  'redeem_gift',
  'urgent_update',
  'reset_password',
  'claim_gift_card',
  'hot_singles',
  'backdoor_install',
  'bank_xss',
  'update_info',
  'flash_games',
  'ip_grab',
  'login_page_2',
  'video_player_update',
  'document',
  'authorize_access',
  'digital_sign',
  'login',
  'celebrity_quiz',
  'secure_login_page',
  'invoice',
  'download_now',
  'click_me',
  'account_verification',
  'money_request',
  'urgent_security_alert',
  'not_virus',
  'malware_obfuscated_release',
  'system_optimizer',
  'photo_viewer_update',
  'crypto_wallet_update',
  'salary_report',
  'private_video',
  'new_message_alert',
  'free_vacation_offer',
  'free_money',
  'phishing_test'
];
const fileExtentions = [
  '',
  '.exe',
  '.msi',
  '.js',
  '.php',
  '.dll',
  '.bat',
  '.scr',
  '.lnk',
  '.docm',
  '.xlsm',
  '.jar',
  '.cmd',
  '.vbs',
  '.pdf',
  '.mp4',
  '.zip',
  '.pl',
  '.com'
];
const folderNames = [
  'system32',
  'Windows',
  'Program_Files',
  'temp',
  'cache',
  'download',
  'update',
  'install',
  'hidden',
  'secret',
  'fbi',
  'cia',
  'nsa',
  'irs',
  'bank',
  'paypal',
  'bitcoin',
  'free_robux',
  'gift_card',
  'lottery',
  'winner',
  'prize',
  'virus',
  'trojan',
  'malware',
  'ransomware',
  'keylogger',
  'surveillance',
  'evidence',
  'leaked',
  'hacked',
  'stolen'
];
const scaryQueryTemplates = [
  '?tracking_id=666&camera_access=true',
  '?steal_password=true&hide_window=1',
  '?lat=38.8977&long=-77.0365&target=acquired',
  '?token=INVALID_TOKEN&redirect=malicious_site',
  '?auto_download=true&execute=immediate',
  '?mining_monero=true&cpu_usage=100',
  '?upload_contacts=true&upload_photos=true',
  '?bypass_firewall=true&admin_rights=granted',
  '?encrypt_files=all&ransom_amount=5BTC',
  '?mic_recording=started&send_to=remote_server',
  '?location_shared=always&notify_contacts=true',
  '?sim_swap=initiated&target_phone=+1-555-0199',
  '?browser_history=export&send_to=parents',
  '?social_security=leaked&check_credit=false',
  '?inject_script=alert(\'hacked\')&mode=stealth',
  '?delete_system32=true&confirm=yes',
  '?remote_desktop=enabled&user=anonymous',
  '?keylogger=active&send_logs=hourly',
  '?vpn_bypass=true&ip_logged=true',
  '?facial_recognition=match_found&identity=stolen'
];

/* ---------------- Helpers ---------------- */
function randomItem(array) {
    return array[Math.floor(Math.random() * array.length)];
}
function generatePath() {
    const depthChance = Math.random();
    let folders = '';
    if (depthChance > 0.6) {
        folders = 
            randomItem(folderNames) + '/' +
            randomItem(folderNames);
    } else if (depthChance > 0.3) {
        folders = randomItem(folderNames) + '/';
    }
    return (
        folders +
        randomItem(prefixParts) + 
        randomItem(baseNames) +
        randomItem(fileExtentions)
    );
}
function generateQuery() {
    const includeQuery = Math.random() > 0.2;
    return includeQuery ? randomItem(scaryQueryTemplates) : '';
}

/* ---------------- URL Normalization ---------------- */

function normalize(url) {
    url = url.trim();

    // Remove protocol
    url = url.replace(/^https?:\/\//, '');

    // Remove www
    url = url.replace(/^www\./, '');

    // YouTube watch → youtu.be (preserve t and list)
    const ytMatch = url.match(/^youtube\.com\/watch\?(.+)/);

    if (ytMatch) {
        const params = new URLSearchParams(ytMatch[1]);
        const videoId = params.get('v');

        if (videoId) {
            let shortUrl = `youtu.be/${videoId}`;

            if (params.get('t')) {
                shortUrl += `?t=${params.get('t')}`;
            }

            if (params.get('list')) {
                const sep = shortUrl.includes('?') ? '&' : '?';
                shortUrl += `${sep}list=${params.get('list')}`;
            }

            return shortUrl;
        }
    }

    return url;
}

/* ---------------- Encoding ---------------- */

function encodeUrlSafe(str) {
    return btoa(str)
        .replace(/\+/g, '-')
        .replace(/\//g, '_')
        .replace(/=+$/, '');
}

function decodeUrlSafe(str) {
    str = str.replace(/-/g, '+').replace(/_/g, '/');
    while (str.length % 4) str += '=';
    return atob(str);
}

// Trusted domains list — keep this small!
const trustedDomains = ['youtube.com', 'vimeo.com', 'amazon.com', 'youtu.be'];

// Function to get the root domain and TLD (ignores subdomains)
function getRootDomainAndTLD(hostname) {
    const parts = hostname.split('.').reverse();
    if (parts.length >= 2) {
        return parts[1] + '.' + parts[0];  // Extract domain + TLD (e.g., youtube.com)
    }
    return hostname;  // For non-standard domain structures
}

// Function to check if the URL belongs to a trusted domain and isn't suspicious
function isTrustedDomain(url) {
    try {
        // Parse the URL using the URL object
        const parsedUrl = new URL(url);
        const hostname = parsedUrl.hostname;

        // Get the root domain and TLD (ignores subdomains)
        const rootDomain = getRootDomainAndTLD(hostname);

        // Check if the root domain and TLD is in the trusted list
        if (trustedDomains.includes(rootDomain)) {

            // Now check if the query parameters contain any suspicious redirects
            const searchParams = parsedUrl.searchParams;
            const suspiciousParams = ['q', 'redirect', 'url', 'destination', 'source', 'forward'];

            for (const param of suspiciousParams) {
                if (searchParams.has(param)) {
                    // If suspicious query parameter is found, block the URL
                    return false;
                }
            }

            // Ensure the protocol is "http" or "https" and prevent file schemes or other unsafe URLs
            if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {
                return false;
            }

            // If it's a clean URL from a trusted domain, it's safe
            return true;
        }

        // If the domain is not trusted, block it
        return false;
    } catch (error) {
        // If URL parsing fails, assume it's not trusted
        return false;
    }
}

/* ---------------- App Logic ---------------- */

const app = document.getElementById("app");
const params = new URLSearchParams(window.location.search);
const accessKey = params.get("access_key");

/* ---------------- Redirect Mode ---------------- */

if (accessKey) {
    try {
        let decoded;

        // Try URL-safe first
        try {
            decoded = decodeUrlSafe(accessKey);
        } catch {
            // Fallback to legacy Base64
            decoded = atob(accessKey);
        }

        // Ensure the URL starts with "http"
        if (!decoded.startsWith("http")) {
            decoded = "https://" + decoded;
        }

        // Check if the decoded URL belongs to a trusted domain
        if (isTrustedDomain(decoded)) {
            // If the link is trusted, redirect immediately
            app.innerHTML = `
                <div class="loading">
                    You’re being redirected to a trusted site... Please wait...
                </div>
            `;
            setTimeout(() => {
                window.location.href = decoded; // Redirect to the decoded URL
            }, 250); // Redirect after a short delay
        } else {
            // For non-trusted sites, display the clickable link after 3 seconds
            app.innerHTML = `
                <div class="loading">
                    This is the decoded URL: <strong>${decoded}</strong><br>
                    The link may not be trusted. Please wait for 3 seconds before clicking.
                </div>
                <div id="linkContainer">
                    <p><a id="redirectLink" target="_blank" style="color: lime;">Click here to visit</a></p>
                </div>
            `;

            // Show the clickable link after 3 seconds
            setTimeout(() => {
                document.getElementById('redirectLink').href = decoded;
            }, 3000);
        }
    } catch {
        app.innerHTML = "<h2>Invalid access key.</h2>";
    }
}


/* ---------------- Generator Mode ---------------- */

else {

    app.innerHTML = `
        <h2>ScaryLink</h2>
        <p>Make your URL look extremely suspicious.</p>
        <input id="urlInput" placeholder="Paste boring URL here..." />
        <button onclick="generateLink()">Generate Scary Link</button>
        <div class="output" id="output"></div>
    `;

    window.generateLink = function() {
        const input = document.getElementById("urlInput").value.trim();
        if (!input) return;

        const normalized = normalize(input);
        const encoded = encodeUrlSafe(normalized);

        const path = generatePath();
        const query = generateQuery();

        const base = window.location.origin;
        const separator = query ? "&" : "?";

        const finalLink =
            `${base}/${path}${query}${separator}access_key=${encoded}`;

        document.getElementById("output").innerHTML = `
            <p><strong>Your Scary Link:</strong></p>
            <p>${finalLink}</p>
        `;
    };
}
</script>
</body>
</html>
